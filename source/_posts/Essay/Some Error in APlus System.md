---
title: 目前系统中的问题

categories: 

- 随笔

tags: 

- 问题记录
date: 2019-04-17
---

项目有如下几个（后端）：

* jx
* yx
* yy

问题如下：

1. 项目名称

   * 如果有新项目，缩写也是yy，则会有冲突，就会变成yy1或者yy-sfdsf，无法见名知意，影响效率。

   * 沟通之间难以顺畅交流。

2. 数据字典

   * 无法见名知意，影响开发，维护的效率，比如说：ZYYWZC006-TF003，谁能看得懂。
   * 网络IO消耗较大，于jx,yx之前的旧代码中(前期代码风格来源于yx)，一个列表20个字段，其中5个是字典项，则一行数据会走5次数据字典的请求，一页20行，则会走20*5=100次请求。假设一次耗时100ms，100 * 100ms=10000ms=10s。后期代码，加了统一的JSON转译，编写复杂度有所下降，且一行数据只请求一次，网络IO耗时下降。
   * 一些代码(前端 or 后端)，直接将字典值写死与项目中，后期维护难度加大，效率降低。
   * 查看测试环境，107和108和yx三个库，每个都有数据字典的表，用的哪个，还是说全部都在用？若数据字典修改，产品可能只修改yx的，但是其他的没有修改，开发，维护，沟通都会受到阻碍。效率降低。
   * 省市区存在于数据字典中，且取的是ID，若想去国家统一区域代码，需要统一（前后端）进行二次处理。耗费性能耗费时间耗费精力。

3. 服务划分边界

   * 服务划分是按照产品的模块进行划分，不合理，如A & B，应该为一个服务才对，但是技术却按照产品原型划分，不考虑后期，不考虑前期，外包风格。由于A & B不应分开，导致开发，维护，效率低下。
   * 服务边界随意制定，没有进行充分考虑。如，X 应属于A服务，但是产品将其放置于B服务，然后不进行考虑，随着产品原型放入B。后期产品意识到了这个问题，将其改回去A服务，技术由于相关原因，知道不合理，却无法迁移回去。
   * 目前虽然是所谓的微服务，但是由于设计原因，却是将服务当成service来用。代码之间耦合性极大，没有起到微服务高内聚低耦合的效果。服务界限非常模糊。

4. 使用MyBatis存在的问题

   * 项目中很多都是like %%，索引无法应用，查询速度会降低非常多。
   * sql全部手写，且大部分都是单表操作，开发效率极低
   * 产品经常修改，导致mapper,entity,resultmap,wiki,db，全都都需要修改，效率极低，BUG率极高
   * 微服务，但是MyBatis不进行多表查询，且没有DBA，无法发挥出MyBatis的优势

5. 安全问题

   * 各个服务之间，目前仅仅能限制登录访问。更细粒度的访问控制，目前没有
   * 所谓的菜单权限，只是前端无法看见而已，如果浏览器地址栏直接输入，基本什么数据都能返回的回去，菜单安全只是假安全
   * 用户体系混乱，这个大部分是产品设计问题
   * 密码为MD5加密且无盐，基本等同于没有加密，且浏览器地址栏直接调用用户查询的话，所有用户用密码什么的全部都会返回回去

6. 注释问题(也可以说复杂度的问题)

   * 实体的注释，wiki的注释，db的注释，swagger的注释，改一个，所有地方都要改，效率低下
   * 由于用的数据字典，entity用的String，根本不知道什么意思

7. 项目测试问题

   * 无单元测试，导致，随便一个问题，比如说加了个字段，都需要整体回归测试一遍
   * test环境无法使用，且uat环境构建极慢，测试及其困难，压力变相集中在测试人员身上。加大测试人员工作量，增加沟通成本。

8. 产品存在的问题(重点问题)

   * 先说一下，说白了，开发人员都是搬砖的，只是其中有技术员，建造师，首席建造师，可能还有科学家等等。而产品是设计师，是艺术家，是乔布斯。设计的不好，考虑的不周，根源就很难改变。
   * 列表页
     * 假设有A，其中有id,name,phone,address三个字段，有B，其中有,orderedTime,orderCode,content三个字段。
     * A的列表页，只展示A的属性，B的列表页，除了B的属性之外，还展示了A的name,phone属性。但是另一个地方，又有一个C，这个地方不仅展示了A的name和phone，还展示了address。又有一个D，展示的更多。
     * 微服务架构（现在勉强算）下，都是单表操作，因此会冗余字段在表里，如果设计不统一，冗余字段越来越多，难以维护（这其中有MyBatis的锅）。如果不冗余，每次都查询其他表，封装DTO，则会导致工作量的加大。同时，参考对数据字典的描述，对性能影响也会很大。
   * 详情页
     * 详情页很多其他页面的列表页嵌套。
     * 列表页统计项很多，且统计项加入查询。
     * 有专门的统计页面可以干，何必每个地方都放一份
     * 权限不好弄，而且，界面模糊，用的人不知道从哪到底能看，只记得哪都能看，极大的可能就会每个详情都点进去看有没有。
   * 固定条件项(数据字典)
     * 比如说，准驾车型。众所周知，中国准驾车型包含有——A1,A2,A3,B1,B2,C1,C2,C3,C4,C5,D,E,F,M。这些应该只有一套在系统里，这些都是通用的，如果说，A页面只想用A1,A2，B页面只想用C1,C2，产品要求只显示这么几个，就会导致数据字典(或者说枚举)里存在多个字典项，一个为最全的，一个为A1,A2，一个为C1,C2。开发，维护复杂度激增。且代码无法复用，效率影响很大。不应该觉得说我这就只能C1或者C2，不现实。太原市电动车执行新国标，如果说，电动车速到了25KM每小时，视为机动车辆，这时候，如果没有增加E或者F驾照的话，视为违章处理，直接扣车。以至于，太原市驾校报考摩托车驾照的人数激增。
     * 能通用的条件应尽量通用，如：培训科目有四个：科目一，科目二，科目三，科目四。所有用到科目这个字段的地方，应当也是这四个科目，而不应该说，只有科目一或者科目二等等。
   * 修改所导致的问题，事故的预判
     * 比如，A服务修改，但是使用到A服务的，可能有B,C,D,E等等，极端情况下，这些地方都需要修改一次。产品应做好预判。同时，技术也应该做好预判。

建议解决办法如下：

1. 项目名称用统一代表标识(比如说，eclipse前年的版本号为Oxygen，一看就知道是什么版本，什么时候发布的)，不推荐每个release过程都一个代号，但是每个项目应该有一个代号来代称。
2. 全面抛弃数据字典，统一使用枚举进行相关工作。随之而来的就是一堆问题：
   1. MyBatis对枚举支持不友好。如果换成枚举，则ORM框架应当变更为Spring Data JPA。
   2. yx,jx所有列表页，详情页等等，后端代码需要重写，同时，前端代码，需要重新联调，耗时很长。有些地方，甚至需要产品层面进行相应变更。
   3. 地区，应按照国标进行存储，数据库只存code，提供统一接口进行处理，而非code以及含义全部入库，如学员，现在更简单，全部存到address这个字段上，如有变化或者新的需求，效率太低。
   4. 合库合表
3. 抛弃微服务，业务不了解，技术不了解，边界区分不了，且目前微服务是当成service来用，发挥不出优势，应抛弃，整合，然后资源足够，业务成熟的情况，进行微服务拆分。
4. 需与产品进行沟通，按照产品的风格，选择MyBatis or Spring Data JPA。
5. 应当根据现在的情况，以后以后的可能性，重新设计Security系统，需要产品同时进行规划RBAC。
6. 面向对象，而不面向数据库，注释只存在一份即可，wiki能自动生成最好。
7. 单元测试添加，环境隔离。

